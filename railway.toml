[build]
builder = "DOCKERFILE"
# Usa Dockerfile per avere PostgreSQL installato
# Railway rileva automaticamente il Dockerfile nella root
[build.environment]
NIXPACKS_PKG_MGR = "npm"

[deploy]
startCommand = "npm run dev"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[environments.production]
[environments.production.deploy]
# PostgreSQL è un servizio separato, non serve avviarlo qui
# Build è già fatto nel Dockerfile, quindi eseguiamo solo setup:db e start server
# Usa bash -c per garantire che entrambi i comandi vengano eseguiti
startCommand = "bash -c 'npm run setup:db && node scripts/start-server-with-api.js'"
